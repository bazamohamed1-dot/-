# دليل النقل إلى البيئة الاحترافية (Production Guide)

تم تحديث التطبيق ليكون جاهزاً للعمل في بيئة احترافية باستخدام Docker و Cloudflare Tunnel وقاعدة بيانات PostgreSQL.

## الخطوات الأساسية للتشغيل

### 1. إعداد المتغيرات البيئية
انسخ الملف `.env.example` إلى ملف جديد باسم `.env` وعدل القيم بداخله:
```bash
cp .env.example .env
```
- **SECRET_KEY**: ضع مفتاحاً سرياً عشوائياً.
- **DEBUG**: اتركه `False` في الإنتاج.
- **APP_DOMAIN**: ضع الرابط الخاص بك (مثلاً `https://admin.bazasystems.com`).
- **EMAIL_HOST_...**: إعدادات بريد Gmail لإرسال كلمات المرور.
- **DATABASE_URL**: اتركه كما هو إذا كنت تستخدم Docker (سيتصل بـ PostgreSQL تلقائياً).

### 2. تفعيل النفق (Tunnel)
بما أنك قمت بإنشاء النفق مسبقاً (ID: `2d9d29d3-e0a0-444a-a3f7-529b660531a6`)، يكفي تنفيذ الخطوات التالية لربطه:
1. شغل الملف `setup_tunnel.bat` كمسؤول (Run as Administrator).
2. سيقوم السكريبت بنسخ ملفات الاعتماد (Credentials) وتوجيه الدومين `admin.bazasystems.com` تلقائياً.

*ملاحظة:* إذا لم يعمل التوجيه التلقائي، يرجى إضافة سجل CNAME يدوياً في لوحة تحكم Cloudflare:
- **Type**: CNAME
- **Name**: `admin`
- **Target**: `2d9d29d3-e0a0-444a-a3f7-529b660531a6.cfargotunnel.com`

### 3. تشغيل التطبيق (Docker)
تأكد من تثبيت **Docker Desktop** وتشغيله، ثم نفذ الأمر التالي في مجلد المشروع:
```bash
docker-compose up -d --build
```
- سيقوم هذا الأمر بتحميل الصور اللازمة (Python, Postgres, Cloudflared).
- سيقوم بإنشاء قاعدة البيانات وتطبيق التحديثات (Migrations).
- سيقوم بتشغيل النفق لربط الموقع بالإنترنت.

### 4. الدخول إلى النظام
- الرابط: `https://admin.bazasystems.com`
- المستخدم الافتراضي (إذا لم يكن لديك حساب): سيطلب منك إنشاء أول مستخدم (Superuser) عبر التيرمينال إذا لزم الأمر:
```bash
docker-compose exec web python manage.py createsuperuser
```

## الميزات الجديدة

### 1. نظام الأمان والبريد
- عند إنشاء مستخدم جديد، يتم توليد كلمة مرور قوية وإرسالها عبر البريد الإلكتروني.
- عند أول تسجيل دخول، يُجبر المستخدم على تغيير كلمة المرور.
- تم تفعيل خيار "نسيت كلمة المرور" لإرسال رابط استعادة آمن.

### 2. العمل دون اتصال (Offline Mode)
- التطبيق يدعم العمل بدون إنترنت (PWA).
- تم تحسين الخدمة (Service Worker) لتحميل المكتبات الضرورية (Dexie.js وغيرها) لضمان عمل التطبيق حتى عند انقطاع الاتصال.

### 3. استيراد البيانات (Excel)
- يمكن للمدراء الفرعيين تحديث قواعد بياناتهم عبر استيراد ملفات Excel.
- اذهب إلى: **الإعدادات > استيراد بيانات**.

### 4. التحديثات المستقبلية (Oracle Cloud)
- الهيكلة الحالية (Docker + PostgreSQL + Environment Variables) متوافقة تماماً مع Oracle Cloud.
- عند الانتقال، يكفي نقل ملف `docker-compose.yml` والمجلدات المرتبطة به إلى السيرفر الجديد.

## الدعم الفني
لأي استفسار، يرجى مراجعة ملفات السجلات:
```bash
docker-compose logs -f
```
