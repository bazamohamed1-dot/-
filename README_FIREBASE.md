# دليل إعداد وتشغيل النسخة السحابية (Firebase)

لقد قمت ببرمجة واجهة سحابية للتلاميذ والموظفين تعمل على Firebase Hosting، مع ربطها بتطبيقك المحلي للمزامنة.

## 1. هيكلة المشروع
- **`firebase_app/public/`**: يحتوي على ملفات الواجهة (HTML, CSS, JS). هذه الملفات هي التي سيراها الأولياء والموظفون.
- **`students/management/commands/sync_firestore.py`**: سكربت المزامنة الذي ينقل البيانات من جهازك إلى السحابة والعكس.
- **`students/templates/students/settings.html`**: تمت إضافة زر "مزامنة سحابية" في لوحة التحكم الخاصة بك.

## 2. إعداد الواجهة السحابية (Frontend)

### أ. تهيئة Firebase
1. اذهب إلى [Firebase Console](https://console.firebase.google.com/) وأنشئ مشروعاً جديداً (أو استخدم الحالي).
2. في القائمة الجانبية، اختر **Project Settings** (إعدادات المشروع).
3. في قسم **Your apps**، اختر أيقونة الويب `</>`.
4. انسخ كود التهيئة (Configuration) الذي يظهر لك (الذي يحتوي على `apiKey`, `authDomain`...).
5. افتح الملف `firebase_app/public/app.js` في مجلد المشروع.
6. استبدل الجزء الخاص بـ `const firebaseConfig = { ... }` بالكود الذي نسخته.

### ب. رفع الواجهة (Deploy)
لرفع الموقع ليكون متاحاً للعموم:
1. قم بتحميل وتثبيت [Node.js](https://nodejs.org/) إذا لم يكن مثبتاً.
2. افتح موجه الأوامر (CMD) في مجلد المشروع ونفذ الأوامر التالية:
   ```bash
   npm install -g firebase-tools
   firebase login
   firebase init
   ```
   - عند سؤالك `Which Firebase features do you want to set up?` اختر **Hosting**.
   - عند سؤالك `Select a default Firebase project` اختر مشروعك.
   - عند سؤالك `What do you want to use as your public directory?` اكتب: `firebase_app/public`
   - عند سؤالك `Configure as a single-page app?` اختر **No**.
   - عند سؤالك `Overwrite index.html?` اختر **No**.

3. الآن، لرفع الموقع، نفذ الأمر:
   ```bash
   firebase deploy
   ```
   سيظهر لك رابط الموقع (مثلاً `https://your-project.web.app`). يمكنك ربطه بـ `bazasystems.com` من داخل إعدادات Firebase Hosting.

## 3. إعداد حسابات الموظفين
لدخول الموظفين للواجهة السحابية، يجب إنشاء حسابات لهم:
1. اذهب إلى **Firebase Console** -> **Authentication** -> **Users**.
2. اضغط **Add user**.
3. أدخل البريد الإلكتروني للموظف وكلمة مرور.
4. زود الموظف بهذه البيانات للدخول عبر صفحة `employee.html`.

## 4. كيفية عمل المزامنة

### من جهازك إلى السحابة (Push)
- عند الضغط على زر **"مزامنة سحابية"** في إعدادات المدير، يقوم النظام برفع:
  - قائمة التلاميذ (الاسم، القسم، رقم التعريف).
  - سجلات الغياب والتأخر (آخر 30 يوم).
  - المراسلات والملاحظات (آخر 30 يوم).

### من السحابة إلى جهازك (Pull)
- عندما يسجل الموظف غياباً أو ملاحظة في الموقع، يتم حفظها كـ "تحديث معلق" (Pending Update).
- عند المزامنة، يقوم جهازك بسحب هذه التحديثات.
- تظهر التنبيهات في لوحة التحكم تحت قسم **"مزامنة التحديثات"**.
- يمكنك قبولها (فتُحفظ في قاعدة بياناتك المحلية) أو رفضها.

## 5. ملاحظات هامة للأمان
- **ملف المفاتيح**: تأكد أن الملف `baza-school-app-firebase-adminsdk-fbsvc-c29bbfc9a8.json` موجود في مجلد المشروع الرئيسي، ولا تشاركه مع أحد.
- **قواعد البيانات**: في Firebase Console -> Firestore Database -> Rules، ينصح بتقييد الصلاحيات بحيث لا يمكن لأي شخص قراءة بيانات التلاميذ إلا إذا كان مسجلاً للدخول (للموظفين) أو يعرف رقم التعريف (للأولياء).

بالتوفيق!
