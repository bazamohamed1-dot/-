# دليل التشغيل دون اتصال (Offline-First Manual)

هذا الدليل يشرح كيفية إعداد وتشغيل التطبيق كنظام "دون اتصال" (Offline-First) ليعمل في المناطق التي لا تتوفر فيها شبكة إنترنت دائمة، مع مزامنة البيانات تلقائياً عند العودة للمكتب.

## 1. التثبيت على الهواتف (PWA)
التطبيق مصمم ليعمل كتطبيق هاتف (PWA).
1. تأكد من أن الهاتف متصل بشبكة الويفي الخاصة بالسيرفر (أو الإنترنت لأول مرة).
2. افتح الرابط في متصفح Google Chrome:
   `http://192.168.1.100:8000/canteen/`
3. سيظهر زر "تثبيت التطبيق" أو شعار "إضافة للشاشة الرئيسية". اضغط عليه.
4. سيظهر التطبيق كأيقونة مستقلة في قائمة التطبيقات.

**ملاحظة هامة:** يجب فتح التطبيق لأول مرة مع وجود اتصال بالإنترنت (أو السيرفر المحلي) ليتم تحميل ملفات الواجهة (Cache) في ذاكرة الهاتف.

## 2. إعداد السيرفر المحلي (الكمبيوتر المركزي)
لضمان عمل النظام بسلاسة، يجب ضبط الكمبيوتر الذي يعمل عليه السيرفر كالتالي:

### أ. تثبيت العنوان (Static IP)
يجب أن يكون عنوان السيرفر ثابتاً لكي لا يتغير وتفقد الهواتف الاتصال.
1. اذهب لإعدادات الشبكة (Network Settings) -> خصائص المحول (Adapter Options).
2. اختر IPv4 واضبط العنوان يدوياً:
   - **IP Address:** `192.168.1.100`
   - **Subnet Mask:** `255.255.255.0`
   - **Gateway:** `192.168.1.1` (عنوان الراوتر)

### ب. منع وضع النوم (Never Sleep)
لضمان أن السيرفر لا ينطفئ أثناء عمل الموظفين:
1. اذهب لـ "إعدادات الطاقة" (Power Options).
2. اختر "تغيير إعدادات المخطط" (Change plan settings).
3. اضبط "Put the computer to sleep" على **Never** (أبداً).

### ج. جدار الحماية (Firewall)
اسمح بالاتصال عبر المنفذ 8000:
1. افتح Windows Defender Firewall -> Advanced Settings.
2. أنشئ Inbound Rule جديدة -> Port -> TCP -> 8000 -> Allow the connection.

## 3. كيفية العمل الميداني (في الصحراء)
1. **التقاط الصور/الفيديو:**
   - عند إضافة صورة تلميذ، يقوم التطبيق تلقائياً بضغط الصورة (من 5MB إلى 200KB) لتوفير المساحة.
   - يتم حفظ البيانات فوراً في "قاعدة البيانات المحلية" (IndexedDB) داخل الهاتف.
   - ستظهر رسالة: "تم الحفظ محلياً. سيتم التأكيد النهائي عند توفر الإنترنت".

2. **المزامنة (العودة للمكتب):**
   - بمجرد دخول الموظف مجال تغطية الويفي (Wi-Fi)، سيقوم التطبيق تلقائياً باكتشاف الاتصال.
   - سيظهر إشعار "جاري رفع التحديثات...".
   - يتم إرسال جميع البيانات المخزنة للسيرفر، وتفريغ ذاكرة الهاتف.

## 4. الميزات التقنية
- **التخزين الضخم:** يستخدم `IndexedDB` (عبر مكتبة Dexie.js) لتخزين جيجابايت من البيانات (صور/فيديو) دون قيود المتصفح العادية (5MB).
- **الضغط الذكي:** يستخدم `browser-image-compression` لضغط الصور قبل حفظها.
- **التوافق:** يعمل على Android و iOS (عبر Safari Add to Home).
