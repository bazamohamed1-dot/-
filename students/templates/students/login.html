{% extends 'base.html' %}
{% load static %}

{% block title %}تسجيل الدخول{% endblock %}

{% block body %}
<div style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #f1f5f9;">
    <div class="card" style="width: 100%; max-width: 400px; padding: 40px;">
        <div style="text-align: center; margin-bottom: 30px;">
            <i class="fas fa-school" style="font-size: 3rem; color: var(--primary);"></i>
            <h2 style="margin-top: 15px; color: #1e293b;">تسجيل الدخول</h2>
            <p style="color: #64748b;">نظام تسيير متوسطة بوشنافة عمر</p>
        </div>

        {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" style="padding: 10px; margin-bottom: 20px; border-radius: 6px; background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; font-size: 0.9rem;">
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}

        <form method="post" id="loginForm">
            {% csrf_token %}
            <input type="hidden" name="fingerprint" id="fingerprint">

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">اسم المستخدم</label>
                <div style="position: relative;">
                    <i class="fas fa-user" style="position: absolute; right: 12px; top: 12px; color: #94a3b8;"></i>
                    <input type="text" name="username" class="form-input" required
                           style="width: 100%; padding: 10px 40px 10px 10px; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box;">
                </div>
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">كلمة المرور</label>
                <div style="position: relative;">
                    <i class="fas fa-lock" style="position: absolute; right: 12px; top: 12px; color: #94a3b8;"></i>
                    <input type="password" name="password" class="form-input" required
                           style="width: 100%; padding: 10px 40px 10px 10px; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box;">
                </div>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; padding: 12px;">
                دخول <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Initialize FingerprintJS
    const fpPromise = import('https://openfpcdn.io/fingerprintjs/v3')
      .then(FingerprintJS => FingerprintJS.load());

    fpPromise
      .then(fp => fp.get())
      .then(result => {
        const visitorId = result.visitorId;
        console.log("Fingerprint:", visitorId);
        document.getElementById('fingerprint').value = visitorId;
      })
      .catch(error => console.error(error));
</script>
{% endblock %}
