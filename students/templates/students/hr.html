{% extends 'base.html' %}
{% block title %}الموارد البشرية{% endblock %}
{% block header_title %}تسيير الموارد البشرية{% endblock %}
{% block content %}
<div class="card">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <div style="display:flex; gap:10px;">
            <button class="btn btn-success" onclick="openAddModal()"><i class="fas fa-plus"></i> إضافة موظف</button>
            <button class="btn btn-info" onclick="document.getElementById('hrImport').click()"><i class="fas fa-file-import"></i> استيراد قائمة (Excel)</button>
            <form method="post" enctype="multipart/form-data" id="importForm" style="display:none;">
                {% csrf_token %}
                <input type="file" name="file" id="hrImport" onchange="document.getElementById('importForm').submit()">
            </form>
        </div>
        <input type="text" id="hrSearch" class="form-input" placeholder="بحث..." onkeyup="filterHR()" style="width:250px;">
    </div>

    <table id="hrTable">
        <thead>
            <tr>
                <th>الاسم الكامل</th>
                <th>الوظيفة</th>
                <th>رقم الهاتف</th>
                <th>ملاحظات</th>
                <th>إجراءات</th>
            </tr>
        </thead>
        <tbody>
            {% for emp in employees %}
            <tr>
                <td>{{ emp.full_name }}</td>
                <td>{{ emp.role }}</td>
                <td class="western-nums">{{ emp.phone|default:"-" }}</td>
                <td>{{ emp.notes|default:"" }}</td>
                <td>
                    <a href="{% url 'hr_delete' emp.id %}" class="btn btn-danger" style="padding:5px 10px;" onclick="return confirm('حذف؟')"><i class="fas fa-trash"></i></a>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="5" style="text-align:center;">لا توجد بيانات</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Add Modal -->
<div id="addModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
    <div class="card" style="width:400px; padding:20px;">
        <h3 style="margin-bottom:20px;">إضافة موظف جديد</h3>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="add">
            <div style="margin-bottom:15px;">
                <label style="display:block; margin-bottom:5px;">الاسم الكامل</label>
                <input type="text" name="full_name" class="form-input" required style="width:100%; padding:10px;">
            </div>
            <div style="margin-bottom:15px;">
                <label style="display:block; margin-bottom:5px;">الوظيفة</label>
                <select name="role" class="form-input" style="width:100%; padding:10px;">
                    <option value="أستاذ">أستاذ</option>
                    <option value="إداري">إداري</option>
                    <option value="عامل مهني">عامل مهني</option>
                </select>
            </div>
            <div style="margin-bottom:15px;">
                <label style="display:block; margin-bottom:5px;">رقم الهاتف</label>
                <input type="text" name="phone" class="form-input western-nums" style="width:100%; padding:10px; direction:ltr; text-align:left;">
            </div>
            <div style="margin-bottom:15px;">
                <label style="display:block; margin-bottom:5px;">ملاحظات</label>
                <textarea name="notes" class="form-input" style="width:100%; padding:10px; height:80px;"></textarea>
            </div>
            <div style="display:flex; gap:10px;">
                <button type="submit" class="btn btn-primary" style="flex:1;">حفظ</button>
                <button type="button" class="btn btn-danger" onclick="document.getElementById('addModal').style.display='none'" style="flex:1;">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<script>
    function openAddModal() {
        document.getElementById('addModal').style.display = 'flex';
    }

    function filterHR() {
        const query = document.getElementById('hrSearch').value.toLowerCase();
        const rows = document.querySelectorAll('#hrTable tbody tr');
        rows.forEach(row => {
            const text = row.innerText.toLowerCase();
            row.style.display = text.includes(query) ? '' : 'none';
        });
    }
</script>
{% endblock %}
